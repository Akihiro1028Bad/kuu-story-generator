# Feature Specification: くぅー画像生成UI

**Feature Branch**: `001-ui-creation`  
**Created**: 2025-12-12  
**Status**: Draft  
**Input**: User description: "UIを作成したい"

## Clarifications

### Session 2025-12-12

- Q: ダウンロード画像の出力サイズ → A: 元画像と同じピクセルサイズで出力する
- Q: ダウンロード/保存の形式と端末別挙動 → A: PCはPNG/JPEGを選べる。スマホはJPEGでカメラロールに保存する
- Q: カメラロール保存の対象スマホOS → A: iOSとAndroidの両方
- Q: スマホでカメラロール保存ができない場合の扱い → A: エラー表示＋通常のダウンロードへ切替できる
- Q: PCでの画面レイアウト（操作と結果の見せ方） → A: 2カラム（左: 操作 / 右: 結果・保存）
- Q: スマホでの画面レイアウト（操作と結果の見せ方） → A: 1カラム（上: 結果・保存 / 下: 操作パネル）
- Q: 画面の“進め方”（デザイン/導線） → A: 手順型（ステップ表示）でアップロード→スタイル→生成→保存を順に案内する
- Q: テーマ（配色）の方針 → A: ライトテーマのみ
- Q: 入れる文言（テキスト）の扱い → A: 候補から選択する
- Q: 文字のスタイル（見た目）の決め方 → A: プリセットから選択する
- Q: 文字の場所（配置）の決め方 → A: 位置プリセットから選択する
- Q: 生成完了後の「結果・保存」エリアの表示内容 → A: 生成完了メッセージ＋保存ボタンのみ（ファイル名・サイズ等の詳細は非表示）
- Q: 画像アップロードのサイズ上限と対応形式 → A: サイズ上限: 10MB / 対応形式: JPEG・PNGのみ
- Q: 画像アップロードのバリデーションタイミング → A: クライアント側のみで検証（サーバーはGoogleの画像生成AIにそのまま渡すため、クライアントでできることはクライアントで実施）

## User Scenarios & Testing *(mandatory)*

<!--
  IMPORTANT: User stories should be PRIORITIZED as user journeys ordered by importance.
  Each user story/journey must be INDEPENDENTLY TESTABLE - meaning if you implement just ONE of them,
  you should still have a viable MVP (Minimum Viable Product) that delivers value.
  
  Assign priorities (P1, P2, P3, etc.) to each story, where P1 is the most critical.
  Think of each story as a standalone slice of functionality that can be:
  - Developed independently
  - Tested independently
  - Deployed independently
  - Demonstrated to users independently
-->

### User Story 1 - 画像をアップロードして「くぅー」を生成し、1枚画像としてダウンロードする (Priority: P1)

ユーザーは手元の画像をアップロードし、用意された選択肢（入れる文言・文字スタイル・文字の場所）を選び、「くぅー」文字の生成を実行して、最終的な画像を保存できる。

**Why this priority**: アプリの中核価値（画像に「くぅー」を載せて1枚にして持ち帰る）を最短で提供できるため。

**Independent Test**: 画像を1枚アップロードし、選択肢（文言/見た目/位置）を選んで生成を実行し、保存まで完了できれば、このユーザーストーリーの価値が単独で成立する。

**Acceptance Scenarios**:

1. **Given** まだ画像未選択の状態、**When** ユーザーが画像ファイルを選択してアップロードする、**Then** 画面上でアップロード済みであることが分かり、次の操作（スタイル選択/生成）に進める
2. **Given** 画像がアップロード済みで選択肢が選択可能な状態、**When** ユーザーが文言/見た目/位置を選び生成を実行する、**Then** 進行中が表示され、完了後に保存操作（PC: ダウンロード、スマホ: カメラロール保存）が可能になる
3. **Given** 生成が完了して保存操作が可能な状態、**When** ユーザーが保存を実行する、**Then** 最終画像を保存できる

---

### User Story 2 - 生成のやり直しとエラー時の復帰をストレスなく行う (Priority: P2)

ユーザーは生成処理をやり直したり、エラーが起きた場合でも原因に応じた案内を見て復帰できる。

**Why this priority**: 体験品質に重要で、生成が失敗する/やり直したいケースは現実的に発生しうるため。

**Independent Test**: 代表的な失敗ケース（未アップロード、生成失敗、入力制限）で、ユーザーが次に取るべき行動が明確に示され、操作を継続できることを確認できる。

**Acceptance Scenarios**:

1. **Given** 画像未アップロードの状態、**When** ユーザーが生成を実行しようとする、**Then** 必要な前提（画像アップロードなど）が案内され、生成は開始されない
2. **Given** 生成中の状態、**When** 生成が失敗する、**Then** ユーザー向けのエラーメッセージが表示され、再試行または入力の見直しに誘導される
3. **Given** 生成済みで別のスタイルを試したい状態、**When** ユーザーが別の選択肢を選んで再生成する、**Then** 新しい生成結果が保存対象として更新され、以前の入力（アップロード画像など）は維持される

---

### Edge Cases

- **入力制限**: 画像が10MBを超える、またはJPEG・PNG以外の形式の場合、**クライアント側で検証**し、ユーザーが理解できるメッセージで案内して別ファイル選択に戻れる（サーバー側では検証しない）
- **キャンセル/中断**: 生成中にユーザーが画面遷移や再操作をした場合、破綻した状態にならず安全に復帰できる
- **ネットワーク不安定**: 一時的な失敗と恒久的な失敗（入力不備など）を区別し、再試行手段を提示する
- **モバイル操作**: タップ操作でも主要機能（アップロード、選択、生成、保存）が完結する
- **権限拒否**: スマホでカメラロール保存の権限が拒否/失敗した場合、ユーザーに理由を示し、通常ダウンロードで成果物を持ち帰れる
- **アクセシビリティ**: キーボード操作や支援技術でも、状態（生成中/完了/失敗）が把握できる

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは、ユーザーがローカル画像ファイルをアップロードできるUIを提供しなければならない（対応形式: JPEG・PNGのみ、サイズ上限: 10MB）
- **FR-025**: システムは、画像アップロードのバリデーション（形式・サイズ）を**クライアント側のみ**で実施しなければならない（サーバー側では検証しない）
- **FR-002**: システムは、アップロード済み画像と選択中スタイルがユーザーに明確に分かる状態表示を提供しなければならない
- **FR-003**: システムは、ユーザーが「入れる文言」「文字のスタイル（見た目）」「文字の場所（配置）」を選択できるようにしなければならない
- **FR-004**: システムは、ユーザーが生成（「くぅー」作成と合成）を開始できる操作を提供しなければならない
- **FR-005**: システムは、生成の進行中/完了/失敗をユーザーに分かりやすく提示しなければならない
- **FR-007**: ユーザーは、合成結果を1枚の画像としてダウンロードできなければならない
- **FR-008**: システムは、主要な画面と操作をPC/モバイルの双方で利用できるレスポンシブなUIを提供しなければならない
- **FR-009**: システムは、日本語UIで表示しなければならない
- **FR-010**: システムは、エラー発生時にユーザーが次に取るべき行動（再試行・入力見直し等）が分かるメッセージを提示しなければならない
- **FR-011**: システムは、ユーザーの画像データをサーバー上に永続保存しない前提で動作しなければならない
- **FR-012**: システムは、ダウンロードされる最終画像を**元画像と同じピクセルサイズ**で出力しなければならない
- **FR-013**: システムは、PCでは最終画像を**PNGまたはJPEG**としてユーザーが選択して保存できるようにしなければならない
- **FR-014**: システムは、スマホでは最終画像を**JPEG**として**カメラロールへ保存**できるようにしなければならない
- **FR-015**: システムは、スマホのカメラロール保存を**iOSとAndroidの両方**で提供しなければならない
- **FR-016**: システムは、スマホでカメラロール保存に失敗した場合、ユーザー向けにエラーを提示し、代替手段として**通常ダウンロード**を提供しなければならない
- **FR-017**: システムは、PCでは「操作（左）」と「結果・保存（右）」の2カラムで、保存まで迷いにくいUIを提供しなければならない
- **FR-018**: システムは、スマホでは「結果・保存（上）」と「操作（下）」の1カラムで、保存まで迷いにくいUIを提供しなければならない
- **FR-019**: システムは、操作フローを手順型（ステップ表示）で提示し、アップロード→スタイル→生成→保存の順にユーザーを案内しなければならない
- **FR-020**: システムは、ライトテーマのみのUIを提供しなければならない
- **FR-021**: システムは、ユーザーが「入れる文言」を**候補一覧から選択**できるようにしなければならない
- **FR-022**: システムは、ユーザーが「文字のスタイル（見た目）」を**プリセットから選択**できるようにしなければならない
- **FR-023**: システムは、ユーザーが「文字の場所（配置）」を**位置プリセットから選択**できるようにしなければならない
- **FR-024**: システムは、生成完了時に**生成完了メッセージと保存ボタン**のみを表示し、ファイル名・サイズ等の詳細情報は表示しなくてよい

### Non-Functional Requirements

- **NFR-001（性能）**: LCP は 3秒以内を目標とする（憲章）
- **NFR-002（セキュリティ）**: 外部AIのAPIキーはサーバー側で管理し、クライアントへ露出しない（憲章）
- **NFR-003（品質ゲート）**: CIで `lint` / `type-check` / `test` を自動実行する（憲章）
- **NFR-004（テスト）**: ユニットテストは必須とする（憲章）

#### Assumptions（前提）

- 認証・ユーザー登録は行わない
- UIは「アップロード→スタイル→生成→保存」の一本道を迷わず進められることを優先する
- SNSへの直接投稿は対象外とし、成果物はダウンロードで持ち帰る
- 生成された合成結果は、ユーザーによる位置・サイズ・回転などの微調整なしに、そのまま保存（ダウンロード）する

### Key Entities *(include if feature involves data)*

- **UploadedImage**: ユーザーがアップロードした元画像（ファイル情報、生成リクエストに必要な情報）
- **TextPhraseOption**: 入れる文言の候補（表示名、実際の文言）
- **PositionPreset**: 文字の配置候補（名称、配置の種類）
- **StylePreset**: 文字の見た目を表すスタイル選択肢（名称、説明、選択状態）
- **GeneratedKuuAsset**: 生成された「くぅー」素材（合成に必要な情報）
- **CompositionResult**: 合成された最終結果（保存の対象）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 初回利用ユーザーが、アップロード→生成→ダウンロードまでを **3分以内** に完了できる
- **SC-002**: 主要フロー（アップロード→生成→ダウンロード）の **初回タスク完了率が90%以上** である
- **SC-003**: 生成処理中であることがユーザーに伝わり、待ち状態での離脱（ブラウザ戻る/閉じる等）が **20%未満** である
- **SC-004**: エラー発生時に、ユーザーが再試行または入力修正により作業を再開できる割合が **80%以上** である
